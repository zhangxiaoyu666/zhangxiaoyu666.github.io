<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="1. HBase的数据存储原理">
<meta name="keywords" content="HBase">
<meta property="og:type" content="article">
<meta property="og:title" content="HBase底层原理与实战">
<meta property="og:url" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/index.html">
<meta property="og:site_name" content="一只鱼的博客">
<meta property="og:description" content="1. HBase的数据存储原理">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/hbase%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84.png">
<meta property="og:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/hbase_data_storage-1565601156263.png">
<meta property="og:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/region.png">
<meta property="og:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/hbase%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B.png">
<meta property="og:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/hbase%E5%86%99%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B.png">
<meta property="og:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/hbase-split-compaction.png">
<meta property="og:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/personSplit.png">
<meta property="og:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/splitFile.png">
<meta property="og:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/hbasePreSplit.png">
<meta property="og:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/testRegion.png">
<meta property="og:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/testMerge.png">
<meta property="og:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/online_merge.png">
<meta property="og:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/%E5%B0%8F%E7%BB%93.png">
<meta property="og:updated_time" content="2020-03-04T03:35:34.561Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HBase底层原理与实战">
<meta name="twitter:description" content="1. HBase的数据存储原理">
<meta name="twitter:image" content="http://yoursite.com/2020/03/03/HBase底层原理与实战/hbase%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84.png">
  <link rel="canonical" href="http://yoursite.com/2020/03/03/HBase底层原理与实战/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>HBase底层原理与实战 | 一只鱼的博客</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">一只鱼的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">七秒钟的记忆多一秒</p>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-question-circle"></i>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
      
        
      
        
      
        
          
        
      
    

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-question-circle"></i>标签<span class="badge">44</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    
      
      
        
      
        
          
        
      
        
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-question-circle"></i>分类<span class="badge">10</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
      
        
          
        
      
        
      
        
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-question-circle"></i>归档<span class="badge">67</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-schedule">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/schedule/" rel="section"><i class="fa fa-fw fa-calendar"></i>日程表</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-sitemap">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/sitemap.xml" rel="section"><i class="fa fa-fw fa-sitemap"></i>站点地图</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-commonweal">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/404/" rel="section"><i class="fa fa-fw fa-heartbeat"></i>公益 404</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/03/HBase底层原理与实战/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小鱼儿">
      <meta itemprop="description" content="肩膀有点痒，可能在长小翅膀">
      <meta itemprop="image" content="/images/fish.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一只鱼的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">HBase底层原理与实战

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-03-03 14:47:21" itemprop="dateCreated datePublished" datetime="2020-03-03T14:47:21+08:00">2020-03-03</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-04 11:35:34" itemprop="dateModified" datetime="2020-03-04T11:35:34+08:00">2020-03-04</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/大数据开发/" itemprop="url" rel="index"><span itemprop="name">大数据开发</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="1-HBase的数据存储原理"><a href="#1-HBase的数据存储原理" class="headerlink" title="1. HBase的数据存储原理"></a>1. HBase的数据存储原理</h2><p><img src="/2020/03/03/HBase底层原理与实战/hbase%E5%AD%98%E5%82%A8%E6%9E%B6%E6%9E%84.png" alt></p>
<a id="more"></a>

<p><img src="/2020/03/03/HBase底层原理与实战/hbase_data_storage-1565601156263.png" alt></p>
<ul>
<li>一个HRegionServer会负责管理很多个region</li>
<li>一个<strong>region</strong>包含很多个<strong>store</strong><ul>
<li>一个<strong>列族</strong>就划分成一个<strong>store</strong></li>
<li>如果一个表中只有1个列族，那么每一个region中只有一个store</li>
<li>如果一个表中有N个列族，那么每一个region中有N个store</li>
</ul>
</li>
<li>一个store里面只有一个memstore<ul>
<li>memstore是一块<strong>内存区域</strong>，写入的数据会先写入memstore进行缓冲，然后再把数据刷到磁盘</li>
</ul>
</li>
<li>一个store里面有很多个<strong>StoreFile</strong>, 最后数据是以很多个<strong>HFile</strong>这种数据结构的文件保存在HDFS上<ul>
<li>StoreFile是HFile的抽象对象，如果说到StoreFile就等于HFile</li>
<li><strong>每次memstore刷写数据到磁盘，就生成对应的一个新的HFile文件出来</strong></li>
</ul>
</li>
</ul>
<p><img src="/2020/03/03/HBase底层原理与实战/region.png" alt></p>
<h2 id="2-HBase读数据流程"><a href="#2-HBase读数据流程" class="headerlink" title="2. HBase读数据流程"></a>2. HBase读数据流程</h2><p><img src="/2020/03/03/HBase底层原理与实战/hbase%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B.png" alt></p>
<blockquote>
<p>说明：HBase集群，只有一张meta表，此表只有一个region，该region数据保存在一个HRegionServer上</p>
</blockquote>
<ul>
<li>1、客户端首先与zk进行连接；从zk找到meta表的region位置，即meta表的数据存储在某一HRegionServer上；客户端与此HRegionServer建立连接，然后读取meta表中的数据；meta表中存储了所有用户表的region信息，我们可以通过<code>scan  &#39;hbase:meta&#39;</code>来查看meta表信息</li>
<li>2、根据要查询的namespace、表名和rowkey信息。找到写入数据对应的region信息</li>
<li>3、找到这个region对应的regionServer，然后发送请求</li>
<li>4、查找并定位到对应的region</li>
<li>5、先从memstore查找数据，如果没有，再从BlockCache上读取<ul>
<li>HBase上Regionserver的内存分为两个部分<ul>
<li>一部分作为Memstore，主要用来写；</li>
<li>另外一部分作为BlockCache，主要用于读数据；</li>
</ul>
</li>
</ul>
</li>
<li>6、如果BlockCache中也没有找到，再到StoreFile上进行读取<ul>
<li>从storeFile中读取到数据之后，不是直接把结果数据返回给客户端，而是把数据先写入到BlockCache中，目的是为了加快后续的查询；然后在返回结果给客户端。</li>
</ul>
</li>
</ul>
<h2 id="3-HBase写数据流程"><a href="#3-HBase写数据流程" class="headerlink" title="3. HBase写数据流程"></a>3. HBase写数据流程</h2><p><img src="/2020/03/03/HBase底层原理与实战/hbase%E5%86%99%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B.png" alt></p>
<ul>
<li>1、客户端首先从zk找到meta表的region位置，然后读取meta表中的数据，meta表中存储了用户表的region信息</li>
<li>2、根据namespace、表名和rowkey信息。找到写入数据对应的region信息</li>
<li>3、找到这个region对应的regionServer，然后发送请求</li>
<li>4、把数据分别写到HLog（write ahead log）和memstore各一份</li>
<li>5、memstore达到阈值后把数据刷到磁盘，生成storeFile文件</li>
<li>6、删除HLog中的历史数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">补充：</span><br><span class="line">HLog（write ahead log）：</span><br><span class="line">	也称为WAL意为Write ahead log，类似mysql中的binlog,用来做灾难恢复时用，HLog记录数据的所有变更,一旦数据修改，就可以从log中进行恢复。</span><br></pre></td></tr></table></figure>

<h2 id="4-HBase的flush、compact机制"><a href="#4-HBase的flush、compact机制" class="headerlink" title="4. HBase的flush、compact机制"></a>4. HBase的flush、compact机制</h2><p><img src="/2020/03/03/HBase底层原理与实战/hbase-split-compaction.png" alt></p>
<h3 id="4-1-Flush触发条件"><a href="#4-1-Flush触发条件" class="headerlink" title="4.1 Flush触发条件"></a>4.1 Flush触发条件</h3><h4 id="4-1-1-memstore级别限制"><a href="#4-1-1-memstore级别限制" class="headerlink" title="4.1.1 memstore级别限制"></a>4.1.1 memstore级别限制</h4><ul>
<li>当Region中任意一个MemStore的大小达到了上限（hbase.hregion.memstore.flush.size，默认128MB），会触发Memstore刷新。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.hregion.memstore.flush.size<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>134217728<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-region级别限制"><a href="#4-1-2-region级别限制" class="headerlink" title="4.1.2 region级别限制"></a>4.1.2 region级别限制</h4><ul>
<li>当Region中所有Memstore的大小总和达到了上限（hbase.hregion.memstore.block.multiplier * hbase.hregion.memstore.flush.size，默认 2* 128M = 256M），会触发memstore刷新。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.hregion.memstore.flush.size<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>134217728<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.hregion.memstore.block.multiplier<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-1-3-Region-Server级别限制"><a href="#4-1-3-Region-Server级别限制" class="headerlink" title="4.1.3 Region Server级别限制"></a>4.1.3 Region Server级别限制</h4><ul>
<li>当一个Region Server中所有Memstore的大小总和超过低水位阈值hbase.regionserver.global.memstore.size.lower.limit*hbase.regionserver.global.memstore.size（前者默认值0.95），RegionServer开始强制flush；</li>
<li>先Flush Memstore最大的Region，再执行次大的，依次执行；</li>
<li>如写入速度大于flush写出的速度，导致总MemStore大小超过高水位阈值hbase.regionserver.global.memstore.size（默认为JVM内存的40%），此时RegionServer会阻塞更新并强制执行flush，直到总MemStore大小低于低水位阈值</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.regionserver.global.memstore.size.lower.limit<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>0.95<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.regionserver.global.memstore.size<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>0.4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-1-4-HLog数量上限"><a href="#4-1-4-HLog数量上限" class="headerlink" title="4.1.4 HLog数量上限"></a>4.1.4 HLog数量上限</h4><ul>
<li>当一个Region Server中HLog数量达到上限（可通过参数hbase.regionserver.maxlogs配置）时，系统会选取最早的一个 HLog对应的一个或多个Region进行flush</li>
</ul>
<h4 id="4-1-5-定期刷新Memstore"><a href="#4-1-5-定期刷新Memstore" class="headerlink" title="4.1.5 定期刷新Memstore"></a>4.1.5 定期刷新Memstore</h4><ul>
<li>默认周期为1小时，确保Memstore不会长时间没有持久化。为避免所有的MemStore在同一时间都进行flush导致的问题，定期的flush操作有20000左右的随机延时。</li>
</ul>
<h4 id="4-1-6-手动flush"><a href="#4-1-6-手动flush" class="headerlink" title="4.1.6 手动flush"></a>4.1.6 手动flush</h4><ul>
<li>用户可以通过shell命令<code>flush ‘tablename’</code>或者<code>flush ‘region name’</code>分别对一个表或者一个Region进行flush。</li>
</ul>
<h3 id="4-2-flush的流程"><a href="#4-2-flush的流程" class="headerlink" title="4.2 flush的流程"></a>4.2 flush的流程</h3><ul>
<li>为了减少flush过程对读写的影响，将整个flush过程分为三个阶段：<ul>
<li>prepare阶段：遍历当前Region中所有的Memstore，将Memstore中当前数据集CellSkipListSet做一个<strong>快照snapshot</strong>；然后再新建一个CellSkipListSet。后期写入的数据都会写入新的CellSkipListSet中。prepare阶段需要加一把updateLock对<strong>写请求阻塞</strong>，结束之后会释放该锁。因为此阶段没有任何费时操作，因此持锁时间很短。</li>
<li>flush阶段：遍历所有Memstore，将prepare阶段生成的snapshot持久化为<strong>临时文件</strong>，临时文件会统一放到目录.tmp下。这个过程因为涉及到磁盘IO操作，因此相对比较耗时。</li>
<li>commit阶段：遍历所有Memstore，将flush阶段生成的临时文件移到指定的ColumnFamily目录下，针对HFile生成对应的storefile和Reader，把storefile添加到HStore的storefiles列表中，最后再<strong>清空</strong>prepare阶段生成的snapshot。</li>
</ul>
</li>
</ul>
<h3 id="4-3-Compact合并机制"><a href="#4-3-Compact合并机制" class="headerlink" title="4.3  Compact合并机制"></a>4.3  Compact合并机制</h3><ul>
<li>hbase为了<strong>防止小文件过多</strong>，以保证查询效率，hbase需要在必要的时候将这些小的store file合并成相对较大的store file，这个过程就称之为compaction。</li>
<li>在hbase中主要存在两种类型的compaction合并<ul>
<li><strong>minor compaction 小合并</strong></li>
<li><strong>major compaction 大合并</strong></li>
</ul>
</li>
</ul>
<h4 id="4-3-1-minor-compaction-小合并"><a href="#4-3-1-minor-compaction-小合并" class="headerlink" title="4.3.1 minor compaction 小合并"></a>4.3.1 minor compaction 小合并</h4><ul>
<li><p>在将Store中多个HFile合并为一个HFile</p>
<p>在这个过程中会选取一些小的、相邻的StoreFile将他们合并成一个更大的StoreFile，对于超过了TTL的数据、更新的数据、删除的数据仅仅只是做了标记。并没有进行物理删除，一次Minor Compaction的结果是更少并且更大的StoreFile。这种合并的触发频率很高。</p>
</li>
<li><p>minor compaction触发条件由以下几个参数共同决定：</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--表示至少需要三个满足条件的store file时，minor compaction才会启动--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.hstore.compactionThreshold<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--表示一次minor compaction中最多选取10个store file--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.hstore.compaction.max<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>10<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--默认值为128m,</span></span><br><span class="line"><span class="comment">表示文件大小小于该值的store file 一定会加入到minor compaction的store file中</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.hstore.compaction.min.size<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>134217728<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--默认值为LONG.MAX_VALUE，</span></span><br><span class="line"><span class="comment">表示文件大小大于该值的store file 一定会被minor compaction排除--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.hstore.compaction.max.size<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>9223372036854775807<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-3-2-major-compaction-大合并"><a href="#4-3-2-major-compaction-大合并" class="headerlink" title="4.3.2 major compaction 大合并"></a>4.3.2 major compaction 大合并</h4><ul>
<li><p>合并Store中所有的HFile为一个HFile</p>
<p>将所有的StoreFile合并成一个StoreFile，这个过程还会清理三类无意义数据：被删除的数据、TTL过期数据、版本号超过设定版本号的数据。合并频率比较低，默认<strong>7天</strong>执行一次，并且性能消耗非常大，建议生产关闭(设置为0)，在应用空闲时间手动触发。一般可以是手动控制进行合并，防止出现在业务高峰期。</p>
</li>
<li><p>major compaction触发时间条件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--默认值为7天进行一次大合并，--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.hregion.majorcompaction<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>604800000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>手动触发</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##使用major_compact命令</span></span><br><span class="line">major_compact tableName</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="4-4-region切分"><a href="#4-4-region切分" class="headerlink" title="4.4 region切分"></a>4.4 region切分</h3><p>当hfile大小超过10G时，region1将会被切分为2个region。首先region1会下线，然后region1切分为region001和region002，最后region001和region002上线，响应client的io请求。</p>
<h2 id="5-HBase表的预分区"><a href="#5-HBase表的预分区" class="headerlink" title="5. HBase表的预分区"></a>5. HBase表的预分区</h2><ul>
<li>当一个table刚被创建的时候，Hbase默认的分配一个region给table。也就是说这个时候，所有的读写请求都会访问到同一个regionServer的同一个region中，这个时候就达不到负载均衡的效果了，集群中的其他regionServer就可能会处于比较空闲的状态。</li>
<li>解决这个问题可以用<strong>pre-splitting</strong>,在创建table的时候就配置好，生成多个region。</li>
</ul>
<h3 id="5-1-为何要预分区？"><a href="#5-1-为何要预分区？" class="headerlink" title="5.1 为何要预分区？"></a>5.1 为何要预分区？</h3><ul>
<li>增加数据读写效率</li>
<li>负载均衡，防止数据倾斜</li>
<li>方便集群容灾调度region</li>
<li>优化Map数量</li>
</ul>
<h3 id="5-2-预分区原理"><a href="#5-2-预分区原理" class="headerlink" title="5.2 预分区原理"></a>5.2 预分区原理</h3><ul>
<li>每一个region维护着startRow与endRowKey，如果加入的数据符合某个region维护的rowKey范围，则该数据交给这个region维护。</li>
</ul>
<h3 id="5-3-手动指定预分区"><a href="#5-3-手动指定预分区" class="headerlink" title="5.3 手动指定预分区"></a>5.3 手动指定预分区</h3><ul>
<li>三种方式</li>
<li>方式一</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create <span class="string">'person'</span>,<span class="string">'info1'</span>,<span class="string">'info2'</span>,SPLITS =&gt; [<span class="string">'1000'</span>,<span class="string">'2000'</span>,<span class="string">'3000'</span>,<span class="string">'4000'</span>]</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/03/HBase底层原理与实战/personSplit.png" alt></p>
<ul>
<li><p>方式二：也可以把分区规则创建于文件中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /kkb/install</span><br><span class="line"></span><br><span class="line">vim split.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>文件内容</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aaa</span><br><span class="line">bbb</span><br><span class="line">ccc</span><br><span class="line">ddd</span><br></pre></td></tr></table></figure>

<ul>
<li>hbase shell中，执行命令</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create <span class="string">'student'</span>,<span class="string">'info'</span>,SPLITS_FILE =&gt; <span class="string">'/kkb/install/split.txt'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>成功后查看web界面</li>
</ul>
<p><img src="/2020/03/03/HBase底层原理与实战/splitFile.png" alt></p>
</li>
<li><p>方式三： HexStringSplit 算法</p>
<ul>
<li>HexStringSplit会将数据从“00000000”到“FFFFFFFF”之间的数据长度按照<strong>n等分</strong>之后算出每一段的其实rowkey和结束rowkey，以此作为拆分点。</li>
<li>例如：</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create <span class="string">'mytable'</span>, <span class="string">'base_info'</span>,<span class="string">' extra_info'</span>, &#123;NUMREGIONS =&gt; <span class="number">15</span>, SPLITALGO =&gt; <span class="string">'HexStringSplit'</span>&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="/2020/03/03/HBase底层原理与实战/hbasePreSplit.png" alt></p>
<h2 id="6-region-合并"><a href="#6-region-合并" class="headerlink" title="6. region 合并"></a>6. region 合并</h2><h3 id="6-1-region合并说明"><a href="#6-1-region合并说明" class="headerlink" title="6.1 region合并说明"></a>6.1 region合并说明</h3><ul>
<li>Region的合并不是为了性能,  而是出于维护的目的 .</li>
<li>比如删除了大量的数据 ,这个时候每个Region都变得很小 ,存储多个Region就浪费了 ,这个时候可以把Region合并起来，进而可以减少一些Region服务器节点 </li>
</ul>
<h3 id="6-2-如何进行region合并"><a href="#6-2-如何进行region合并" class="headerlink" title="6.2 如何进行region合并"></a>6.2 如何进行region合并</h3><h4 id="6-2-1-通过Merge类冷合并Region"><a href="#6-2-1-通过Merge类冷合并Region" class="headerlink" title="6.2.1 通过Merge类冷合并Region"></a>6.2.1 通过Merge类冷合并Region</h4><ul>
<li>执行合并前，<strong>需要先关闭hbase集群</strong></li>
<li>创建一张hbase表：</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create <span class="string">'test'</span>,<span class="string">'info1'</span>,SPLITS =&gt; [<span class="string">'1000'</span>,<span class="string">'2000'</span>,<span class="string">'3000'</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>查看表region</li>
</ul>
<p><img src="/2020/03/03/HBase底层原理与实战/testRegion.png" alt></p>
<ul>
<li><p>需求：</p>
<p>需要把test表中的2个region数据进行合并：<br>test,,1565940912661.62d28d7d20f18debd2e7dac093bc09d8.<br>test,1000,1565940912661.5b6f9e8dad3880bcc825826d12e81436.</p>
</li>
<li><p>这里通过org.apache.hadoop.hbase.util.Merge类来实现，<strong>不需要</strong>进入hbase shell，直接执行（<strong>需要先关闭hbase集群</strong>）：<br>hbase org.apache.hadoop.hbase.util.Merge test test,,1565940912661.62d28d7d20f18debd2e7dac093bc09d8. test,1000,1565940912661.5b6f9e8dad3880bcc825826d12e81436.</p>
</li>
<li><p>成功后界面观察</p>
</li>
</ul>
<p><img src="/2020/03/03/HBase底层原理与实战/testMerge.png" alt></p>
<h4 id="6-2-2-通过online-merge热合并Region"><a href="#6-2-2-通过online-merge热合并Region" class="headerlink" title="6.2.2  通过online_merge热合并Region"></a>6.2.2  通过online_merge热合并Region</h4><ul>
<li><p><strong>不需要关闭hbase集群</strong>，在线进行合并</p>
</li>
<li><p>与冷合并不同的是，online_merge的传参是Region的hash值，而Region的hash值就是Region名称的最后那段在两个.之间的字符串部分。</p>
</li>
<li><p>需求：需要把test表中的2个region数据进行合并：<br>test,2000,1565940912661.c2212a3956b814a6f0d57a90983a8515.<br>test,3000,1565940912661.553dd4db667814cf2f050561167ca030.</p>
</li>
<li><p>需要进入hbase shell：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">merge_region <span class="string">'c2212a3956b814a6f0d57a90983a8515'</span>,<span class="string">'553dd4db667814cf2f050561167ca030'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>成功后观察界面</p>
</li>
</ul>
<p><img src="/2020/03/03/HBase底层原理与实战/online_merge.png" alt></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="/2020/03/03/HBase底层原理与实战/%E5%B0%8F%E7%BB%93.png" alt></p>
<p>生产中，hbase表的列族一般是一个或两个。</p>
<p>一个列族的memstore刷写，也会造成其他的列族中的memstore的刷写。</p>
<p>一般将经常一起写入的数据放到同一个列族下，person info:age,address,底层的数据最终是一个列族对应一个文件hfile</p>

    </div>

    
    
    
        
      
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>小鱼儿</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://yoursite.com/2020/03/03/HBase底层原理与实战/" title="HBase底层原理与实战">http://yoursite.com/2020/03/03/HBase底层原理与实战/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-Hans" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>
</div>

      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/HBase/" rel="tag"># HBase</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2020/03/02/HBase基本原理/" rel="next" title="HBase基本原理">
                  <i class="fa fa-chevron-left"></i> HBase基本原理
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2020/03/04/HBase与MR与hive集成/" rel="prev" title="HBase与MR与hive集成">
                  HBase与MR与hive集成 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-HBase的数据存储原理"><span class="nav-number">1.</span> <span class="nav-text">1. HBase的数据存储原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-HBase读数据流程"><span class="nav-number">2.</span> <span class="nav-text">2. HBase读数据流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-HBase写数据流程"><span class="nav-number">3.</span> <span class="nav-text">3. HBase写数据流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-HBase的flush、compact机制"><span class="nav-number">4.</span> <span class="nav-text">4. HBase的flush、compact机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Flush触发条件"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 Flush触发条件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-memstore级别限制"><span class="nav-number">4.1.1.</span> <span class="nav-text">4.1.1 memstore级别限制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-region级别限制"><span class="nav-number">4.1.2.</span> <span class="nav-text">4.1.2 region级别限制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-3-Region-Server级别限制"><span class="nav-number">4.1.3.</span> <span class="nav-text">4.1.3 Region Server级别限制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-4-HLog数量上限"><span class="nav-number">4.1.4.</span> <span class="nav-text">4.1.4 HLog数量上限</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-5-定期刷新Memstore"><span class="nav-number">4.1.5.</span> <span class="nav-text">4.1.5 定期刷新Memstore</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-6-手动flush"><span class="nav-number">4.1.6.</span> <span class="nav-text">4.1.6 手动flush</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-flush的流程"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 flush的流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-Compact合并机制"><span class="nav-number">4.3.</span> <span class="nav-text">4.3  Compact合并机制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-minor-compaction-小合并"><span class="nav-number">4.3.1.</span> <span class="nav-text">4.3.1 minor compaction 小合并</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-2-major-compaction-大合并"><span class="nav-number">4.3.2.</span> <span class="nav-text">4.3.2 major compaction 大合并</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-region切分"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 region切分</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-HBase表的预分区"><span class="nav-number">5.</span> <span class="nav-text">5. HBase表的预分区</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-为何要预分区？"><span class="nav-number">5.1.</span> <span class="nav-text">5.1 为何要预分区？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-预分区原理"><span class="nav-number">5.2.</span> <span class="nav-text">5.2 预分区原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-手动指定预分区"><span class="nav-number">5.3.</span> <span class="nav-text">5.3 手动指定预分区</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-region-合并"><span class="nav-number">6.</span> <span class="nav-text">6. region 合并</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-region合并说明"><span class="nav-number">6.1.</span> <span class="nav-text">6.1 region合并说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-如何进行region合并"><span class="nav-number">6.2.</span> <span class="nav-text">6.2 如何进行region合并</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-通过Merge类冷合并Region"><span class="nav-number">6.2.1.</span> <span class="nav-text">6.2.1 通过Merge类冷合并Region</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-2-通过online-merge热合并Region"><span class="nav-number">6.2.2.</span> <span class="nav-text">6.2.2  通过online_merge热合并Region</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">7.</span> <span class="nav-text">总结</span></a></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/fish.png"
      alt="小鱼儿">
  <p class="site-author-name" itemprop="name">小鱼儿</p>
  <div class="site-description" itemprop="description">肩膀有点痒，可能在长小翅膀</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    
  
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-Hans" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小鱼儿</span>
</div>

        












        
      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script>
<script src="/js/schemes/pisces.js?v=7.4.1"></script>

<script src="/js/next-boot.js?v=7.4.1"></script>



  





















  

  

  

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>

